"<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Master JP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f0f4f8;
        }

        .typing-font {
            font-family: 'JetBrains+Mono', 'Noto Sans JP', monospace;
        }

        .char {
            display: inline;
            border-bottom: 3px solid #e2e8f0;
            transition: all 0.2s ease;
            margin: 0 1px;
        }

        .char.correct {
            color: #10b981;
            border-bottom-color: #10b981;
        }

        .char.incorrect {
            color: #ef4444;
            border-bottom-color: #ef4444;
            background-color: #fee2e2;
        }

        .char.current {
            border-bottom-color: #3b82f6;
            background-color: #dbeafe;
        }

        .stats-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="max-w-4xl w-full bg-white rounded-3xl shadow-2xl p-8 space-y-8">
        <!-- Header -->
        <div class="text-center">
            <h1 class="text-4xl font-black text-blue-600 tracking-tight">Typing Master JP</h1>
            <p class="text-gray-500 mt-2 font-medium">漢字変換対応・実践タイピング練習</p>
        </div>

        <!-- Stats Display -->
        <div class="grid grid-cols-3 gap-6">
            <div class="stats-card bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-2xl text-center border border-blue-200">
                <div class="text-xs text-blue-600 font-bold uppercase tracking-widest mb-1">WPM (文字/分)</div>
                <div id="wpm" class="text-4xl font-black text-blue-900">0</div>
            </div>
            <div class="stats-card bg-gradient-to-br from-emerald-50 to-emerald-100 p-6 rounded-2xl text-center border border-emerald-200">
                <div class="text-xs text-emerald-600 font-bold uppercase tracking-widest mb-1">Accuracy (正確率)</div>
                <div id="accuracy" class="text-4xl font-black text-emerald-900">100%</div>
            </div>
            <div class="stats-card bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-2xl text-center border border-purple-200">
                <div class="text-xs text-purple-600 font-bold uppercase tracking-widest mb-1">Time (経過時間)</div>
                <div id="timer" class="text-4xl font-black text-purple-900">0s</div>
            </div>
        </div>

        <!-- Typing Area -->
        <div class="relative group">
            <div id="sentence-display" class="typing-font text-3xl leading-relaxed text-gray-400 p-10 bg-gray-50 rounded-2xl border-2 border-gray-200 min-h-[160px] flex flex-wrap items-center justify-center text-center">
                <!-- Sentences will be injected here -->
            </div>
            
            <!-- Input Area for IME Support -->
            <div class="mt-6">
                <input type="text" id="typing-input" 
                    class="w-full p-4 text-xl border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 outline-none transition-all text-center"
                    placeholder="ここに文字を入力して変換・確定してください"
                    autocomplete="off">
            </div>

            <div id="focus-notice" class="absolute inset-0 flex items-center justify-center bg-white/95 rounded-2xl hidden z-10">
                <p class="text-blue-600 font-bold text-xl">クリックして入力を開始してください</p>
            </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col items-center gap-4 pt-4">
            <button id="reset-btn" class="px-12 py-4 bg-gray-800 text-white rounded-2xl font-bold hover:bg-black active:scale-95 transition-all flex items-center gap-3 shadow-xl">
                <span class="text-lg">次の問題へ</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7-7 7M5 5l7 7-7 7" />
                </svg>
            </button>
            <p class="text-sm text-gray-400">変換を確定したタイミングで判定されます。バックスペースで修正も可能です。</p>
        </div>
    </div>

    <script>
        const sentences = [
            "継続は力なり",
            "笑う門には福来る",
            "初心忘るべからず",
            "日進月歩の勢い",
            "一期一会の出会い",
            "早起きは三文の徳",
            "雲外蒼天を目指す",
            "七転八起の精神",
            "温故知新を大切にする",
            "明日は明日の風が吹く",
            "思い立ったが吉日です",
            "雨降って地固まる",
            "千里の道も一歩から",
            "案ずるより産むが易し",
            "失敗は成功の基です",
            "今日はとてもいい天気ですね",
            "楽しくタイピングを練習しましょう",
            "パソコンの操作に慣れる",
            "美味しいご飯を食べたい",
            "夢に向かって努力する"
        ];

        let currentSentence = "";
        let startTime = null;
        let timerInterval = null;
        let totalTypedCharacters = 0;
        let totalMistakes = 0;
        let isActive = false;

        const display = document.getElementById('sentence-display');
        const input = document.getElementById('typing-input');
        const wpmDisplay = document.getElementById('wpm');
        const accuracyDisplay = document.getElementById('accuracy');
        const timerDisplay = document.getElementById('timer');
        const resetBtn = document.getElementById('reset-btn');

        function initGame() {
            let newSentence;
            do {
                newSentence = sentences[Math.floor(Math.random() * sentences.length)];
            } while (newSentence === currentSentence);
            
            currentSentence = newSentence;
            totalTypedCharacters = 0;
            totalMistakes = 0;
            isActive = false;
            startTime = null;
            clearInterval(timerInterval);
            
            wpmDisplay.innerText = "0";
            accuracyDisplay.innerText = "100%";
            timerDisplay.innerText = "0s";
            input.value = "";
            input.disabled = false;

            renderSentence("");
            input.focus();
        }

        function renderSentence(userInput) {
            display.innerHTML = "";
            const targetChars = currentSentence.split('');
            const userChars = userInput.split('');

            targetChars.forEach((char, index) => {
                const span = document.createElement('span');
                span.innerText = char;
                span.className = 'char';

                if (index < userChars.length) {
                    if (userChars[index] === char) {
                        span.classList.add('correct');
                    } else {
                        span.classList.add('incorrect');
                    }
                } else if (index === userChars.length) {
                    span.classList.add('current');
                }
                
                display.appendChild(span);
            });
        }

        function updateStats() {
            if (!startTime) return;
            const timeElapsed = (Date.now() - startTime) / 1000;
            const minutes = timeElapsed / 60;
            
            // WPM: Correct characters / Time
            const correctChars = display.querySelectorAll('.correct').length;
            const wpm = minutes > 0 ? Math.round(correctChars / minutes) : 0;
            
            // Accuracy: Based on current display state
            const totalShownInput = display.querySelectorAll('.correct, .incorrect').length;
            const currentMistakes = display.querySelectorAll('.incorrect').length;
            const accuracy = totalShownInput > 0 ? Math.round(((totalShownInput - currentMistakes) / totalShownInput) * 100) : 100;

            wpmDisplay.innerText = wpm;
            accuracyDisplay.innerText = `${accuracy}%`;
            timerDisplay.innerText = `${Math.floor(timeElapsed)}s`;
        }

        input.addEventListener('input', (e) => {
            if (!isActive && input.value.length > 0) {
                isActive = true;
                startTime = Date.now();
                timerInterval = setInterval(updateStats, 500);
            }

            const userInput = e.target.value;
            renderSentence(userInput);
            updateStats();

            // Check if finished
            if (userInput === currentSentence) {
                finishRound();
            }
        });

        function finishRound() {
            isActive = false;
            clearInterval(timerInterval);
            input.disabled = true;
            
            display.classList.add('ring-8', 'ring-emerald-400', 'bg-emerald-50');
            setTimeout(() => {
                display.classList.remove('ring-8', 'ring-emerald-400', 'bg-emerald-50');
            }, 1000);
        }

        resetBtn.addEventListener('click', initGame);

        // Initial setup
        window.onload = initGame;
    </script>
</body>
</html>"