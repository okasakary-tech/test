"<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Master - ãƒ­ãƒ¼ãƒå­—ç·´ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');
        
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            overflow: hidden; 
        }

        .glass-morphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 2rem;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .word-display-kanji {
            font-size: 3.5rem;
            font-weight: 700;
            color: #1e293b;
        }

        .word-display-roma {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            color: #6366f1;
            background: #f1f5f9;
            padding: 0.5rem 1.5rem;
            border-radius: 1rem;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pulse { animation: pulse 2s infinite; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="glass-morphism w-full max-w-2xl p-8 md:p-12 text-center">
        <h1 class="text-3xl font-bold text-indigo-800 mb-8">Typing Master JP ğŸš€</h1>

        <div class="grid grid-cols-2 gap-4 mb-10">
            <div class="bg-blue-50 p-4 rounded-2xl">
                <p class="text-sm text-blue-600 font-bold uppercase tracking-wider">æ®‹ã‚Šæ™‚é–“</p>
                <p id="timer" class="text-3xl font-bold text-blue-900">60s</p>
            </div>
            <div class="bg-emerald-50 p-4 rounded-2xl">
                <p class="text-sm text-emerald-600 font-bold uppercase tracking-wider">ã‚¹ã‚³ã‚¢</p>
                <p id="score" class="text-3xl font-bold text-emerald-900">0</p>
            </div>
        </div>

        <div id="game-view" class="space-y-6">
            <div id="word-display-area" class="min-h-[200px] flex flex-col justify-center items-center gap-6">
                <div id="kanji-container" class="word-display-kanji">
                    <span class="text-slate-400 text-xl">ã€ŒEnterã€ã§é–‹å§‹ï¼</span>
                </div>
                <div id="roma-container" class="word-display-roma hidden"></div>
            </div>

            <input type="text" id="type-input" 
                class="w-full text-2xl p-4 rounded-xl border-2 border-indigo-100 focus:border-indigo-500 focus:outline-none transition-all text-center disabled:bg-slate-50"
                placeholder="ãƒ­ãƒ¼ãƒå­—ã‚’å…¥åŠ›..."
                autocomplete="off"
                disabled>

            <div id="start-button-area">
                <button id="start-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xl font-bold px-12 py-4 rounded-2xl shadow-lg transition-all transform hover:scale-105 active:scale-95 pulse">
                    ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                </button>
                <p class="text-slate-400 text-sm mt-4">Escã‚­ãƒ¼ã§ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</p>
            </div>
        </div>

        <div id="result-view" class="hidden space-y-6">
            <h2 class="text-4xl font-bold text-indigo-900">ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼</h2>
            <div class="py-8">
                <p class="text-lg text-slate-600">1åˆ†é–“ã®æ­£è§£æ•°ã¯...</p>
                <p class="text-6xl font-black text-indigo-600 my-4"><span id="final-score">0</span> å›</p>
                <p id="rank-message" class="text-xl font-bold text-slate-500"></p>
            </div>
            <div class="flex flex-col gap-4 items-center">
                <button id="retry-btn" class="bg-slate-800 hover:bg-black text-white text-lg font-bold px-10 py-3 rounded-xl transition-all">
                    ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹ (Enter)
                </button>
                <button id="back-to-home-btn" class="text-indigo-600 font-medium hover:underline">
                    ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹ (Esc)
                </button>
            </div>
        </div>
    </div>

    <script>
        const wordList = [
            { kanji: "å¤ªé™½", roma: "taiyou" }, { kanji: "é’ç©º", roma: "aozora" }, { kanji: "æœªæ¥", roma: "mirai" },
            { kanji: "å®‡å®™", roma: "utyuu" }, { kanji: "å½—æ˜Ÿ", roma: "suisei" }, { kanji: "è™¹", roma: "niji" },
            { kanji: "æ£®æ—", roma: "sinrin" }, { kanji: "æ·±æµ·", roma: "sinkai" }, { kanji: "æº€æœˆ", roma: "mangetsu" },
            { kanji: "ç™½ç†Š", roma: "sirokuma" }, { kanji: "éº’éºŸ", roma: "kirin" }, { kanji: "å­çŠ¬", roma: "koinu" },
            { kanji: "é£›é³¥", roma: "asuka" }, { kanji: "é¯¨", roma: "kujira" }, { kanji: "èœœèœ‚", roma: "mitsubati" },
            { kanji: "æ—æª", roma: "ringo" }, { kanji: "ç‰›ä¹³", roma: "gyuunyuu" }, { kanji: "ç·‘èŒ¶", roma: "ryokutya" },
            { kanji: "æœé£Ÿ", roma: "tyousoku" }, { kanji: "è‹º", roma: "itigo" }, { kanji: "èœ‚èœœ", roma: "hatimitsu" },
            { kanji: "å‹é”", roma: "tomodati" }, { kanji: "å­¦æ ¡", roma: "gakkou" }, { kanji: "å›³æ›¸é¤¨", roma: "tosyokan" },
            { kanji: "é‰›ç­†", roma: "enpitsu" }, { kanji: "é»’æ¿", roma: "kokuban" }, { kanji: "å®¿é¡Œ", roma: "syukudai" },
            { kanji: "é‹å‹•ä¼š", roma: "undoukai" }, { kanji: "æ”¾èª²å¾Œ", roma: "houkago" }, { kanji: "åˆ¶æœ", roma: "seifuku" },
            { kanji: "å¸Œæœ›", roma: "kibou" }, { kanji: "ç¬‘é¡”", roma: "egao" }, { kanji: "æ„Ÿè¬", roma: "kansya" },
            { kanji: "å‹‡æ°—", roma: "yuuki" }, { kanji: "å¹³å’Œ", roma: "heiwa" }, { kanji: "åŠªåŠ›", roma: "doryoku" },
            { kanji: "æ„Ÿå‹•", roma: "kandou" }, { kanji: "å¹¸ç¦", roma: "koufuku" }, { kanji: "å°Šæ•¬", roma: "sonkei" },
            { kanji: "å†’é™º", roma: "bouken" }, { kanji: "ç§˜å¯†", roma: "himitsu" }, { kanji: "æ™‚è¨ˆ", roma: "tokei" },
            { kanji: "åœ°å›³", roma: "tizu" }, { kanji: "åˆ‡æ‰‹", roma: "kitte" }, { kanji: "é›»è»Š", roma: "densya" },
            { kanji: "è‡ªè»¢è»Š", roma: "zitensya" }, { kanji: "å…¬åœ’", roma: "kouen" }, { kanji: "ç¥ç¤¾", roma: "zinzyo" },
            { kanji: "å‘æ—¥è‘µ", roma: "himawari" }, { kanji: "æ¡œ", roma: "sakura" }, { kanji: "ç´…è‘‰", roma: "momizi" },
            { kanji: "é›ªé”ç£¨", roma: "yukidaruma" }, { kanji: "è›", roma: "hotaru" }
        ];

        let timeLeft = 60;
        let score = 0;
        let isPlaying = false;
        let currentPair = null;
        let timerId;

        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const kanjiContainer = document.getElementById('kanji-container');
        const romaContainer = document.getElementById('roma-container');
        const typeInput = document.getElementById('type-input');
        const startBtn = document.getElementById('start-btn');
        const startBtnArea = document.getElementById('start-button-area');
        const retryBtn = document.getElementById('retry-btn');
        const backToHomeBtn = document.getElementById('back-to-home-btn');
        const gameView = document.getElementById('game-view');
        const resultView = document.getElementById('result-view');
        const finalScore = document.getElementById('final-score');
        const rankMessage = document.getElementById('rank-message');

        function init() {
            startBtn.addEventListener('click', startGame);
            retryBtn.addEventListener('click', startGame);
            backToHomeBtn.addEventListener('click', resetToHome);
            typeInput.addEventListener('keydown', filterWrongInput);
            typeInput.addEventListener('input', checkInput);
            window.addEventListener('keydown', handleGlobalKeys);
        }

        function handleGlobalKeys(e) {
            if (e.key === 'Enter') {
                if (!isPlaying) startGame();
            } else if (e.key === 'Escape') {
                resetToHome();
            }
        }

        // Logic to allow both 'zi/ji' and 'zyo/jo'
        function filterWrongInput(e) {
            if (!isPlaying) return;
            if (e.key.length > 1) return;

            const inputSoFar = typeInput.value.toLowerCase();
            const currentRoma = currentPair.roma;
            const nextIndex = inputSoFar.length;
            const nextCharInGuide = currentRoma[nextIndex];
            const pressedKey = e.key.toLowerCase();

            // Special handling for 'zi' / 'ji'
            if (currentRoma.substring(nextIndex, nextIndex + 2) === "zi") {
                if (pressedKey === "z" || pressedKey === "j") return;
            }
            if (nextIndex > 0 && inputSoFar[nextIndex - 1] === "j" && currentRoma[nextIndex] === "i") {
                if (pressedKey === "i") return;
            }

            // Special handling for 'zyo' / 'jo'
            // Check for 'z' in 'zyo'
            if (currentRoma.substring(nextIndex, nextIndex + 3) === "zyo") {
                if (pressedKey === "z" || pressedKey === "j") return;
            }
            // If user typed 'j', allow 'o' next (skipping 'y')
            if (nextIndex > 0 && inputSoFar[nextIndex - 1] === "j" && currentRoma.substring(nextIndex, nextIndex + 2) === "yo") {
                if (pressedKey === "o") return;
            }

            // Standard character check
            if (pressedKey !== nextCharInGuide) {
                e.preventDefault();
            }
        }

        function startGame() {
            score = 0;
            timeLeft = 60;
            isPlaying = true;
            scoreDisplay.textContent = score;
            timerDisplay.textContent = timeLeft + "s";
            gameView.classList.remove('hidden');
            resultView.classList.add('hidden');
            startBtnArea.classList.add('hidden');
            romaContainer.classList.remove('hidden');
            typeInput.disabled = false;
            typeInput.value = "";
            typeInput.focus();
            nextWord();
            if (timerId) clearInterval(timerId);
            startTimer();
        }

        function startTimer() {
            timerId = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft + "s";
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function nextWord() {
            const randomIndex = Math.floor(Math.random() * wordList.length);
            currentPair = wordList[randomIndex];
            kanjiContainer.textContent = currentPair.kanji;
            romaContainer.textContent = currentPair.roma;
            typeInput.value = "";
        }

        function checkInput() {
            if (!isPlaying) return;
            const val = typeInput.value.toLowerCase();
            const target = currentPair.roma;

            // Flexible matching for zi/ji and zyo/jo
            let normalizedVal = val.replace(/ji/g, "zi").replace(/jo/g, "zyo");
            let normalizedTarget = target.replace(/ji/g, "zi").replace(/jo/g, "zyo");

            if (normalizedVal === normalizedTarget) {
                score++;
                scoreDisplay.textContent = score;
                nextWord();
            }
        }

        function endGame() {
            clearInterval(timerId);
            isPlaying = false;
            typeInput.disabled = true;
            gameView.classList.add('hidden');
            resultView.classList.remove('hidden');
            finalScore.textContent = score;
            if (score >= 50) {
                rankMessage.textContent = "é©šç•°çš„ãªã‚¹ãƒ”ãƒ¼ãƒ‰ï¼ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼ğŸ‘‘";
            } else if (score >= 35) {
                rankMessage.textContent = "ã™ã”ã„ï¼ã‹ãªã‚Šã®è…•å‰ã§ã™ã­ï¼ğŸ”¥";
            } else if (score >= 20) {
                rankMessage.textContent = "ã„ã„èª¿å­ã§ã™ï¼ã“ã®ã¾ã¾ç·´ç¿’ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ï¼âœ¨";
            } else {
                rankMessage.textContent = "æ­£ç¢ºã«æ‰“ã¦ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã­ï¼æ¬¡ã¯ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼ğŸŒ±";
            }
        }

        function resetToHome() {
            clearInterval(timerId);
            isPlaying = false;
            gameView.classList.remove('hidden');
            resultView.classList.add('hidden');
            startBtnArea.classList.remove('hidden');
            romaContainer.classList.add('hidden');
            typeInput.disabled = true;
            typeInput.value = "";
            kanjiContainer.innerHTML = '<span class="text-slate-400 text-xl">ã€ŒEnterã€ã§é–‹å§‹ï¼</span>';
            romaContainer.textContent = '';
            timeLeft = 60;
            score = 0;
            timerDisplay.textContent = "60s";
            scoreDisplay.textContent = "0";
        }

        init();
    </script>
</body>
</html>"